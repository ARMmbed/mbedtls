language: c
compiler:
- clang
- gcc
sudo: false
cache: ccache

# blocklist
branches:
  except:
  - development-psa
  - coverity_scan

script:
- tests/scripts/recursion.pl library/*.c
- tests/scripts/check-generated-files.sh
- tests/scripts/check-doxy-blocks.pl
- tests/scripts/check-names.sh
- tests/scripts/check-files.py
- tests/scripts/doxygen.sh
- cmake -D CMAKE_BUILD_TYPE:String="Check" .
- make
- make test
- programs/test/selftest
- OSSL_NO_DTLS=1 tests/compat.sh
- tests/ssl-opt.sh -e '\(DTLS\|SCSV\).*openssl'
- tests/scripts/test-ref-configs.pl
- tests/scripts/curves.pl
- tests/scripts/key-exchanges.pl
after_failure:
- tests/scripts/travis-log-failure.sh
env:
  global:
    - SEED=1
    - secure: "HbZs1dLQi+zgPQfJuvGEFGlrrMhiiX1w4uPXnNtmpGu9AB3mBvDBrlJChFLkXfQw0DNinkSlLYXnP+g4auvo8jVJKrxwMp6ebz7tclLZsb9+oMlf8dOEZYb8GNcjkpjSZ1IaibdapaI4ZUmtqhxPsMTM5diRZfOGPvpypeR17tw="

before_install:
  - echo -n | openssl s_client -connect https://scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-

addons:
  apt:
    packages:
    - doxygen
    - graphviz
  coverity_scan:
    project:
      name: "ARMmbed/mbedtls"
    notification_email: vikas.katariya@arm.com
    build_command_prepend:
    build_command: make
    branch_pattern: dev/jainvikas8/travis-coverity
